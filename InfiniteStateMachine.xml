<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.plcopen.org/xml/tc6_0200">
  <fileHeader companyName="" productName="CODESYS" productVersion="CODESYS V3.5 SP21 Patch 2" creationDateTime="2025-08-31T14:32:38.5379288" />
  <contentHeader name="Infinite State Machine Library" version="0.1.0.0" modificationDateTime="2025-08-31T14:32:18.2590946" organization="Roy Ratcliffe" author="Roy Ratcliffe">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1" />
      </fbd>
      <ld>
        <scaling x="1" y="1" />
      </ld>
      <sfc>
        <scaling x="1" y="1" />
      </sfc>
    </coordinateInfo>
    <addData>
      <data name="http://www.3s-software.com/plcopenxml/projectinformation" handleUnknown="implementation">
        <ProjectInformation>
          <property name="Author" type="string">Roy Ratcliffe</property>
          <property name="Company" type="string">Roy Ratcliffe</property>
          <property name="DefaultNamespace" type="string">ISM</property>
          <property name="Description" type="string" />
          <property name="DocFormat" type="string">reStructuredText</property>
          <property name="IsEndUserLibrary" type="boolean">false</property>
          <property name="LanguageModelAttribute" type="string">qualified-access-only</property>
          <property name="Placeholder" type="string" />
          <property name="Project" type="string">InfiniteStateMachine</property>
          <property name="Released" type="boolean">false</property>
          <property name="Title" type="string">Infinite State Machine Library</property>
          <property name="Version" type="version">0.1.0.0</property>
          <property name="library-category-list" type="library-category-list" />
        </ProjectInformation>
      </data>
      <data name="http://www.3s-software.com/plcopenxml/autogeneratedobjects" handleUnknown="implementation">
        <AutogeneratedObjects>
          <libraryInfoFunctions>true</libraryInfoFunctions>
          <projectInfoFunctions>false</projectInfoFunctions>
          <propertyAccessorFunctions>false</propertyAccessorFunctions>
        </AutogeneratedObjects>
      </data>
    </addData>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="IStatePtr">
        <baseType>
          <pointer>
            <baseType>
              <derived name="IState" />
            </baseType>
          </pointer>
        </baseType>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>67d77a7c-dd2b-4411-a6e6-ae5e74133961</ObjectId>
          </data>
        </addData>
      </dataType>
      <dataType name="IStatePtrArray">
        <baseType>
          <array>
            <dimension lower="0" upper="ISM.gc_iMaxDepth" />
            <baseType>
              <derived name="IStatePtr" />
            </baseType>
          </array>
        </baseType>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c4f85b64-2f39-41e4-8528-d81e8a225514</ObjectId>
          </data>
        </addData>
      </dataType>
    </dataTypes>
    <pous>
      <pou name="StateMachine" pouType="functionBlock">
        <interface>
          <localVars>
            <variable name="apitfStates">
              <type>
                <derived name="IStatePtrArray" />
              </type>
            </variable>
            <variable name="iDepth">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
          </localVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/accessmodifiers" handleUnknown="implementation">
              <AccessModifiers Final="true" />
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml" />
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Jump" ObjectId="f8c3c10c-54fc-49ce-9585-70eb1e21c408">
              <interface>
                <inputVars>
                  <variable name="itfState">
                    <type>
                      <derived name="IState" />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">iDepth := Topology(itfState, ISM.gc_iMaxDepth, apitfStates);
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Top" ObjectId="62fc3b46-bec4-4351-863f-d1d11d3e8a72">
              <interface>
                <returnType>
                  <derived name="IStatePtr" />
                </returnType>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF iDepth &gt; 0 THEN
	Top := apitfStates[iDepth - 1];
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Push" ObjectId="95a8a034-9180-43ce-8bfd-c478425733d0">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="itfState">
                    <type>
                      <derived name="IState" />
                    </type>
                  </variable>
                </inputVars>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/accessmodifiers" handleUnknown="implementation">
                    <AccessModifiers Protected="true" />
                  </data>
                </addData>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">Push := iDepth &lt; ISM.gc_iMaxDepth;
IF Push THEN
	apitfStates[iDepth] := ADR(itfState);
	iDepth := iDepth + 1;
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Pop" ObjectId="6c98f508-a113-4f8e-8aef-8f47e33c25ed">
              <interface>
                <returnType>
                  <derived name="IStatePtr" />
                </returnType>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/accessmodifiers" handleUnknown="implementation">
                    <AccessModifiers Protected="true" />
                  </data>
                </addData>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF iDepth &gt; 0 THEN
	iDepth := iDepth - 1;
	Pop := apitfStates[iDepth];
    (*
     * Clear the popped state from the stack. This is not strictly necessary,
     * but it can help catch use-after-free bugs.
     *)
	apitfStates[iDepth] := 0;
ELSE
	Pop := 0;
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="GoTo" ObjectId="e4a689a8-30a8-40c4-a1a1-64a429463f54">
              <interface>
                <inputVars>
                  <variable name="itfState">
                    <type>
                      <derived name="IState" />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="fbStateMachine">
                    <type>
                      <derived name="StateMachine" />
                    </type>
                  </variable>
                  <variable name="iDepth">
                    <type>
                      <INT />
                    </type>
                    <initialValue>
                      <simpleValue value="0" />
                    </initialValue>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">fbStateMachine.Jump(itfState);
WHILE iDepth &lt; Depth() AND iDepth &lt; fbStateMachine.Depth() AND AtLevel(iDepth) = fbStateMachine.AtLevel(iDepth) DO
	iDepth := iDepth + 1;
END_WHILE
WHILE Depth() &gt; iDepth DO
	Leave();
END_WHILE
WHILE fbStateMachine.Depth() &gt; iDepth DO
	Enter(fbStateMachine.AtLevel(iDepth)^);
	iDepth := iDepth + 1;
END_WHILE
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Depth" ObjectId="2331109e-e2eb-41f7-9dc7-cd4ae70fd217">
              <interface>
                <returnType>
                  <INT />
                </returnType>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">Depth := iDepth;
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="AtLevel" ObjectId="91eea73d-a85e-45a7-83bb-4c59b4021a4e">
              <interface>
                <returnType>
                  <derived name="IStatePtr" />
                </returnType>
                <inputVars>
                  <variable name="iLevel">
                    <type>
                      <INT />
                    </type>
                  </variable>
                </inputVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF 0 &lt;= iLevel AND iLevel &lt; iDepth THEN
	AtLevel := apitfStates[iLevel];
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Enter" ObjectId="d3919794-61ce-43b7-a567-3762fa33fec2">
              <interface>
                <inputVars>
                  <variable name="itfState">
                    <type>
                      <derived name="IState" />
                    </type>
                  </variable>
                </inputVars>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/accessmodifiers" handleUnknown="implementation">
                    <AccessModifiers Protected="true" />
                  </data>
                </addData>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">IF Push(itfState) THEN
	itfState.Enter(THIS^);
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="Leave" ObjectId="a5d1f593-03aa-4839-8991-f4001f19fb2a">
              <interface>
                <localVars>
                  <variable name="pitfState">
                    <type>
                      <derived name="IStatePtr" />
                    </type>
                  </variable>
                </localVars>
                <addData>
                  <data name="http://www.3s-software.com/plcopenxml/accessmodifiers" handleUnknown="implementation">
                    <AccessModifiers Protected="true" />
                  </data>
                </addData>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">pitfState := Pop();
IF pitfState &lt;&gt; 0 THEN
	pitfState^.Leave(THIS^);
END_IF
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/method" handleUnknown="implementation">
            <Method name="In" ObjectId="e699251b-332a-4a1e-ae9b-43de46a9cbf4">
              <interface>
                <returnType>
                  <BOOL />
                </returnType>
                <inputVars>
                  <variable name="itfState">
                    <type>
                      <derived name="IState" />
                    </type>
                  </variable>
                </inputVars>
                <localVars>
                  <variable name="iLevel">
                    <type>
                      <INT />
                    </type>
                    <initialValue>
                      <simpleValue value="0" />
                    </initialValue>
                  </variable>
                </localVars>
              </interface>
              <body>
                <ST>
                  <xhtml xmlns="http://www.w3.org/1999/xhtml">(*
 * The following do-while loop's condition assumes early-out semantics.
 * It assumes that the second sub-condition does *not* evaluate unless the first sub-condition is true.
 *)
WHILE iLevel &lt; iDepth AND apitfStates[iLevel] &lt;&gt; ADR(itfState) DO
	iLevel := iLevel + 1;
END_WHILE
In := iLevel &lt; iDepth;
</xhtml>
                </ST>
              </body>
              <addData />
            </Method>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>af47bfc7-3dc5-4da7-86e9-5e9eb325a76d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="Depth" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="pitfState">
              <type>
                <derived name="IStatePtr" />
              </type>
            </variable>
            <variable name="iDepth">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="apitfStates">
              <type>
                <derived name="REFERENCE TO IStatePtrArray" />
              </type>
            </variable>
          </inputVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="suppress_warning" Value="0561" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF pitfState = 0 THEN
	Depth := 0;
ELSE
	Depth := Topology(pitfState^, iDepth, apitfStates);
END_IF
</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e2f2db89-d2ae-4fb8-ba65-e049b64154e7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="Topology" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="itfState">
              <type>
                <derived name="IState" />
              </type>
            </variable>
            <variable name="iDepth">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="apitfStates">
              <type>
                <derived name="REFERENCE TO IStatePtrArray" />
              </type>
            </variable>
          </inputVars>
          <addData>
            <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
              <Attributes>
                <Attribute Name="suppress_warning" Value="0561" />
              </Attributes>
            </data>
          </addData>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">IF iDepth = 0 THEN
	Topology := 0;
ELSE
	Topology := Depth(itfState.SuperState, iDepth - 1, apitfStates);
	apitfStates[Topology] := ADR(itfState);
	Topology := Topology + 1;
END_IF
</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1b77501e-fe27-4f81-8063-d710bea9b4de</ObjectId>
          </data>
        </addData>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations />
  </instances>
  <addData>
    <data name="http://www.3s-software.com/plcopenxml/globalvars" handleUnknown="implementation">
      <globalVars name="ISM" constant="true">
        <variable name="gc_iMaxDepth">
          <type>
            <INT />
          </type>
          <initialValue>
            <simpleValue value="7" />
          </initialValue>
        </variable>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
            <Attributes>
              <Attribute Name="qualified_only" Value="" />
            </Attributes>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>61a71296-3b39-4b4c-9e67-cea520fcd5cc</ObjectId>
          </data>
        </addData>
      </globalVars>
    </data>
    <data name="http://www.3s-software.com/plcopenxml/interface" handleUnknown="implementation">
      <Interface name="IState" ObjectId="b34f3a77-20f7-46e3-bf5b-b5485e5ce84e">
        <Methods>
          <Method name="Enter" ObjectId="7bd2e26c-741a-4abf-8236-066fc626c1c4">
            <interface>
              <inputVars>
                <variable name="fbStateMachine">
                  <type>
                    <derived name="StateMachine" />
                  </type>
                </variable>
              </inputVars>
            </interface>
            <addData />
          </Method>
          <Method name="Leave" ObjectId="bfd78221-c433-4210-a08d-bf2ff4a209cf">
            <interface>
              <inputVars>
                <variable name="fbStateMachine">
                  <type>
                    <derived name="StateMachine" />
                  </type>
                </variable>
              </inputVars>
            </interface>
            <addData />
          </Method>
        </Methods>
        <Properties>
          <Property name="SuperState" ObjectId="117cc3ab-dc36-4647-8a63-b7117f155ab6">
            <interface>
              <returnType>
                <pointer>
                  <baseType>
                    <derived name="IState" />
                  </baseType>
                </pointer>
              </returnType>
            </interface>
            <SetAccessor />
            <GetAccessor />
            <addData />
          </Property>
        </Properties>
        <addData />
      </Interface>
    </data>
    <data name="http://www.3s-software.com/plcopenxml/libraries" handleUnknown="implementation">
      <Libraries>
        <Library Name="#CAA Types" Namespace="CAA" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="CAA Types Extern, * (CAA Technical Workgroup)" />
        <Library Name="#CAA FB Factory" Namespace="FBF" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="CAA FB Factory, * (CAA Technical Workgroup)" />
        <Library Name="#CBML" Namespace="CBML" HideWhenReferencedAsDependency="false" PublishSymbolsInContainer="false" SystemLibrary="false" LinkAllContent="false" DefaultResolution="Common Behaviour Model, * (3S - Smart Software Solutions GmbH)" />
        <PlaceholderRedirections>
          <PlaceholderRedirection Placeholder="CAA FB Factory" Redirection="CAA FB Factory, 3.5.19.0 (CAA Technical Workgroup)" />
          <PlaceholderRedirection Placeholder="CAA ResMan" Redirection="CAA Ressource Manager Extern, 3.5.17.0 (CAA Technical Workgroup)" />
          <PlaceholderRedirection Placeholder="SysMem" Redirection="SysMem, 3.5.17.0 (System)" />
          <PlaceholderRedirection Placeholder="SysCpuHandling" Redirection="SysCpuHandling, 3.5.17.0 (System)" />
          <PlaceholderRedirection Placeholder="CAA MemBlockMan" Redirection="CAA Memory Block Manager Extern, 3.5.18.0 (CAA Technical Workgroup)" />
          <PlaceholderRedirection Placeholder="CBML" Redirection="Common Behaviour Model, 4.0.0.0 (CODESYS)" />
          <PlaceholderRedirection Placeholder="SysSem Implementation" Redirection="SysSem Implementation, 3.5.17.0 (System)" />
          <PlaceholderRedirection Placeholder="SysSem" Redirection="SysSem, 3.5.17.0 (System)" />
          <PlaceholderRedirection Placeholder="CAA Callback" Redirection="CAA Callback Extern, 3.5.17.0 (CAA Technical Workgroup)" />
          <PlaceholderRedirection Placeholder="CAA Types" Redirection="CAA Types Extern, 3.5.17.0 (CAA Technical Workgroup)" />
        </PlaceholderRedirections>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8c1463b5-02f2-427d-bd06-9e39d42fcbff</ObjectId>
          </data>
        </addData>
      </Libraries>
    </data>
    <data name="http://www.3s-software.com/plcopenxml/projectstructure" handleUnknown="discard">
      <ProjectStructure>
        <Folder Name="InfiniteStateMachine">
          <Folder Name="Function Blocks">
            <Object Name="StateMachine" ObjectId="af47bfc7-3dc5-4da7-86e9-5e9eb325a76d">
              <Object Name="Jump" ObjectId="f8c3c10c-54fc-49ce-9585-70eb1e21c408" />
              <Object Name="Top" ObjectId="62fc3b46-bec4-4351-863f-d1d11d3e8a72" />
              <Object Name="Push" ObjectId="95a8a034-9180-43ce-8bfd-c478425733d0" />
              <Object Name="Pop" ObjectId="6c98f508-a113-4f8e-8aef-8f47e33c25ed" />
              <Object Name="GoTo" ObjectId="e4a689a8-30a8-40c4-a1a1-64a429463f54" />
              <Object Name="Depth" ObjectId="2331109e-e2eb-41f7-9dc7-cd4ae70fd217" />
              <Object Name="AtLevel" ObjectId="91eea73d-a85e-45a7-83bb-4c59b4021a4e" />
              <Object Name="Enter" ObjectId="d3919794-61ce-43b7-a567-3762fa33fec2" />
              <Object Name="Leave" ObjectId="a5d1f593-03aa-4839-8991-f4001f19fb2a" />
              <Object Name="In" ObjectId="e699251b-332a-4a1e-ae9b-43de46a9cbf4" />
            </Object>
          </Folder>
          <Folder Name="Functions">
            <Object Name="Topology" ObjectId="1b77501e-fe27-4f81-8063-d710bea9b4de" />
            <Object Name="Depth" ObjectId="e2f2db89-d2ae-4fb8-ba65-e049b64154e7" />
          </Folder>
          <Folder Name="GlobalConstants">
            <Object Name="ISM" ObjectId="61a71296-3b39-4b4c-9e67-cea520fcd5cc" />
          </Folder>
          <Folder Name="Interfaces">
            <Object Name="IState" ObjectId="b34f3a77-20f7-46e3-bf5b-b5485e5ce84e">
              <Object Name="SuperState" ObjectId="117cc3ab-dc36-4647-8a63-b7117f155ab6" />
              <Object Name="Enter" ObjectId="7bd2e26c-741a-4abf-8236-066fc626c1c4" />
              <Object Name="Leave" ObjectId="bfd78221-c433-4210-a08d-bf2ff4a209cf" />
            </Object>
          </Folder>
          <Folder Name="Types">
            <Object Name="IStatePtrArray" ObjectId="c4f85b64-2f39-41e4-8528-d81e8a225514" />
            <Object Name="IStatePtr" ObjectId="67d77a7c-dd2b-4411-a6e6-ae5e74133961" />
          </Folder>
        </Folder>
        <Object Name="Library Manager" ObjectId="8c1463b5-02f2-427d-bd06-9e39d42fcbff" />
        <Object Name="Project Information" ObjectId="11c0fc3a-9bcf-4dd8-ac38-efb93363e521" />
      </ProjectStructure>
    </data>
  </addData>
</project>